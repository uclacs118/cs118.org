---
layout: ../../layouts/Assigment.astro
title: "Homework 3: TCP/NAT"
dueDate: 2025-02-18 23:59:00
---

Submit your homework solution PDF to Gradescope in any format you please;
however, make sure that each **question part** is on its own page.

# Question 1: TCP Design (25 points)

You are designing a reliable, sliding window, byte-stream protocol **similar to TCP**.
It will be used for communication with a geosynchronous satellite network, for which the bandwidth is 1 Gbps (\\(\tt 1Gbps=10^9\\) bits per second) and the RTT is 200 ms. Assume the maximum segment lifetime is 10 seconds.

1. **(17 points)** What is the minimum number of bits you should use for \\(\tt ReceiveWindow\\) and \\(\tt SequenceNum\\) fields so that full utilization of the channel can be achieved? 
    - Hints: The \\(\tt ReceiveWindow\\) should be able to encode the maximum possible in-flight number of bytes. \\(\tt SequenceNum\\) should be large enough so that the sequence number does not wrap around when the delayed segment is still in the channel.

2. **(8 points)** If \\(\tt ReceiveWindow\\) is 16 bits, what upper bound would that impose on the effective bandwidth?


# Question 2: GBN/SR/TCP (25 points)

In this question you are comparing among the following three schemes:
- **Go-Back-N:** cumulative ACK is used. The ACK number is the sequence number of corresponding segment.
- **Selective Repeat:** individual ACK is used. The ACK number is the sequence number of corresponding segment.
- **TCP:** cumulative ACK is used with no delayed ACK. The ACK number is the next expected sequence number.

Assume that timeout values for all three protocols are sufficiently long, such that 8 consecutive data segments and their corresponding ACKs can be received (if not lost in the channel) by the receiving host (Host B) and the sending host (Host A), respectively.

Suppose:
- Host A sends **8 data segments** to Host B
- **The 5th segment** (sent from A) **is lost**. No other segments are lost.
- In the end, all 8 data segments have been correctly received by Host B. 
- The first segment starts from sequence number 1 and each segment contains 1 byte of data. 
- The round trip time is greater than the transmission time for the 8 segments, so that the first ACK arrives after all 8 segments have been transmitted. 
- For TCP, assume that the connection is already established and you don't need to count the connection establishment.

1. **(18 points)** How many segments has Host A sent in total and how many ACKs has Host B sent in total? What are their sequence numbers? Answer this question for all three protocols.
2. **(7 points)** If the timeout values for all three protocols are very long (e.g., longer than several RTTs), then which protocol successfully delivers all 8 data segments in shortest time interval?


# Question 3: TCP (25 points)

Consider the evolution of a TCP connection with the following characteristics. Assume that all the following algorithms are implemented in TCP congestion control: slow start, congestion avoidance, fast retransmit and fast recovery, and retransmission upon timeout. If \\(\tt ssthresh\\) is equal to \\(\tt cwnd\\), use the slow start algorithm in your calculation.

- The TCP sender sends a number of data segments of 1 byte each. 
- The TCP receiver follows cumulative ACK convention without delayed ACK, i.e. the receiver acknowledges every successfully received segment immediately.
- The RTT is 100 ms for all transmissions, consists of the network latency of 60 ms in sending a segment (header and payload) from the sender to the receiver and 40 ms in sending an acknowledgment (header only) from the receiver to the sender. Ignore packet-processing delays at the sender and the receiver.
- To simplify the setting, rather than estimating RTO from sampled RTT values, the RTO at the sender is set to 500ms and does not change during the connection lifetime.
- Initially \\(\tt ssthresh\\) **at the sender is set to 6**. Assume \\(\tt cwnd\\) and \\(\tt ssthresh\\) are measured in segments, and the transmission time for each segment is negligible.
- The connection (already established) starts to transmit data at time \\(t = 0\\), and the **initial sequence number starts from 1**. TCP segment with **sequence number 6 is lost once** (i.e., it sees segment loss during its first transmission). No other segments are lost during transmissions.

**(25 points)** What are the values for \\(\tt cwnd\\) and \\(\tt ssthresh\\) when the sender receives the TCP **ACK with number 15**? Show your intermediate steps or your diagram in your solution.


# Question 4: NAT (25 points)


Network Address Translation (NAT) is the translation of an IP address used within one network to a different IP address known within another network.
A NAT capable router essentially translates private IP address within a network to public IP addresses that can be visited publicly.
A simple NAT-capable router will have mappings between the private addresses within the network to the public address(es) that it uses.
Suppose that the router has a single public address \\(\tt 131.179.176.1\\) which it uses for all communication with hosts that are not part of the private network.
The private network uses subnet \\(\tt 10.0/16\\).
The router multiplexes its public IP address(es) as needed and keeps track of the multiplexing in a NAT translation table.

Assume that the router multiplexes the public address using ports starting from \\(\tt 8000\\) and then increments the port number by one for each new entry.
For example, if a host behind the router with address and port \\(\tt 10.0.0.5:5000\\) sends a message to an external server \\(\tt 8.8.8.8:53\\), then the entry in the NAT table would be filled in as below.

| \\(\tt IP:Port\\) within private network | \\(\tt IP:Port\\) outside private network |
|----------|----------|
| \\(\tt 10.0.0.5:5000\\)   | \\(\tt 131.179.176.1:8000\\)   |
| ...   | ...   |

The next time the router will use port \\(\tt 8001\\) to establish a new connection and so on.

1. **(15 points)** **Draw the resulting NAT Translation Table** at the end of the following message exchanges following the format of the above Table (including the original entry):

    (1) \\(\tt 10.0.0.6:5000\\) sends a message to \\(\tt 172.217.11.78:80\\)

    (2) \\(\tt 10.0.0.10:6000\\) sends a message to \\(\tt 204.79.197.200:80\\)

    (3) \\(\tt 10.0.1.101:6001\\) sends a message to \\(\tt 206.190.36.45:80\\)

    (4) \\(\tt 10.0.0.10:6000\\) sends a message to \\(\tt 204.79.197.200:80\\)

    (5) \\(\tt 10.0.1.101:6001\\) sends a message to \\(\tt 172.217.11.78:80\\)

    (6) \\(\tt 10.0.0.7:7000\\) sends a message to \\(\tt 63.245.215.20:80\\)

    (7) \\(\tt 204.79.197.200:80\\) sends a message to \\(\tt 131.179.176.1:8002\\)

    (8) \\(\tt 204.79.197.200:80\\) sends a message to \\(\tt 131.179.176.1:8003\\)


2. **(10 points)** For simplicity, let's denote transport-layer messages in the format of \\(\tt MSG \<Sender, Receiver\>\\), where \\(\tt Sender\\) and \\(\tt Receiver\\) represent the IP-port pair of the message's sender and receiver respectively.

    For example, if a host in the private network with IP address and port \\(\tt 10.0.0.5:5000\\) sends a message to \\(\tt 132.239.8.45:80\\).

    Then from the router's point of view, we denote the message received at router and sent from the router as follows:

    - Message Received from Host: \\(\tt MSG \<10.0.0.5:5000, 132.239.8.45:80\>\\)

    - Message Sent from Router: \\(\tt MSG \<131.179.176.1:8000, 132.239.8.45:80\>\\)

    Using the same format as above, **list the messages** received from the host at the router and the message sent from the router for the following messages:

        (1) \\(\tt 10.0.0.6:5000\\) sends a message to \\(\tt 172.217.11.78:80\\)

        (2) \\(\tt 10.0.0.10:6000\\) sends a message to \\(\tt 204.79.197.200:80\\)

    Assume the entries from your NAT Translation Table in the previous problem to do this.